#!/usr/bin/env zsh
# Copyright (c) 2023 Sebastian Gniazdowski
#
# zsqb – zs…quote…braces
#

# Run as script?
[[ $0 != zscan ]]&&integer bescript=1

# Set options
builtin emulate -L zsh -o extendedglob -o noshortloops \
                        -o warncreateglobal -o typesetsilent \
                        -o nopromptsubst

# Set $0 with a new trik - use of %x prompt expansion
0=${${(M)${0::=${(%):-%x}}:#/*}:-$PWD/$0}
: ${ZSDIR:=$0:h:h}

# Load initialization script
source "$0:h:h"/libexec/zs::global-init.zsh

local -A Opts
local -a opts
local QE
builtin zparseopts ${${(M)ZSH_VERSION:#(5.[8-9]|6.[0-9])}:+-F} -D -E -A Opts -- v -func=opts -script=opts C:=opts||return 7

((!$+Opts[--func]&&!$+Opts[--script]))&&zswarn No {opt}--func{txt} nor \
                    {opt}--script{txt} options given, will run both \
                    script and autoload-function checks on all input files
for QE;do
    print
    zsmsg -h {err}Notice: scanning file: {quot}•{warn}${(U)QE}{quot}•{txt}…
    print
    $ZSDIR/libexec/zscan $opts $QE
done