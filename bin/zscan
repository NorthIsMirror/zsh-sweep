#!/usr/bin/env zsh
# Copyright (c) 2023 Sebastian Gniazdowski
#
# zsqb – zs…quote…braces
#

# Run as script?
[[ $0 != zscan ]]&&integer bescript=1

# Set options
builtin emulate -L zsh -o extendedglob -o noshortloops \
                        -o warncreateglobal -o typesetsilent \
                        -o nopromptsubst

# Set $0 with a new trik - use of %x prompt expansion
0=${${(M)${0::=${(%):-%x}}:#/*}:-$PWD/$0}
: ${ZSDIR:=$0:h:h}

# Load initialization script
source "$0:h:h"/libexec/zs::global-init.zsh

local -A Opts
local -a opts
local QE
builtin zparseopts ${${(M)ZSH_VERSION:#(5.[8-9]|6.[0-9])}:+-F} \
        -D -E -A Opts -- \
        v -auto=opts -func=opts -script=opts \
            -src=opts C:=opts||return 7

((!$+Opts[--src]&&!$+Opts[--func]&&!$+Opts[--script]&&!$+Opts[--auto]))&& \
                zswarn None of the opts \
                    {opt}${(j:{txt}, {opt}:):-${=:---func --script \
                    --src --auto}}{txt} given, will run all-kind checks \
                    on all input files
# Process each file
for QE;do
    print
    zsmsg -h {err}Notice:{%} scanning file: {quot}•{warn}${(U)QE}{quot}•{%}…
    (($+Opts[-C]))&&zsmsg -h {err}Notice:{%} work dir set to: {path}$Opts[-C]
    print
    $ZSDIR/libexec/zscan $opts $QE
done